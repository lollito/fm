<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="common/head :: head"></head>


<body>

  <div class="d-flex" id="wrapper">

    <!-- Sidebar -->
    <div th:replace="common/sidebar :: sidebar"></div>
    
    <!-- /#sidebar-wrapper -->

    <!-- Page Content -->
		<div id="page-content-wrapper">
			<nav th:replace="common/navbar :: navbar"></nav>


			<div class="container-fluid">
				<h1 class="mt-2">Home</h1>
				<div class="row">
					<div class="col-sm-12">
						<div class="card text-white bg-warning mb-3">
							<div class="card-header">News</div>
							<div class="card-body">
								<table id="news-table" class="text-white" data-toggle="table" data-url="/api/news/">
									<thead>
										<tr>
											<th data-field="date">Date</th>
											<th data-field="text">News</th>
										</tr>
									</thead>
								</table>
							</div>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-sm-6">
						<div class="col-sm-12">
							<div class="card text-white bg-primary mb-3">
								<div class="card-header">Next Round</div>
								<div class="card-body">
									<table id="next-round-table" data-row-style="matchRowStyle" class="text-white" data-toggle="table" data-url="/api/match/next">
										<thead>
											<tr>
												<th data-field="home.name">Home</th>
												<th data-field="away.name">Away</th>
												<th data-field="date">Date</th>
												<th data-field="number" data-visible="false"></th>
												<th data-field="last" data-visible="false"></th>
												<th data-field="homeScore"></th>
												<th data-field="awayScore"></th>
											</tr>
										</thead>
									</table>
								</div>
							</div>
						</div>
						<div class="col-sm-12">
							<div class="card text-white bg-primary mb-3">
								<div class="card-header">Last Match Results</div>
								<div class="card-body">
									<table id="previous-round-table" class="text-white" data-row-style="matchRowStyle" data-toggle="table" data-url="/api/match/previous">
										<thead>
											<tr>
												<th data-field="home.name">Home</th>
												<th data-field="away.name">Away</th>
												<th data-field="date">Date</th>
												<th data-field="number" data-visible="false"></th>
												<th data-field="last" data-visible="false"></th>
												<th data-field="homeScore"></th>
												<th data-field="awayScore"></th>
											</tr>
										</thead>
									</table>
								</div>
							</div>
						</div>
						<div class="col-sm-12">
							<div class="card text-white bg-primary mb-3">
								<div class="card-header">News</div>
								<div class="card-body">
									<h4 class="card-title">Coming Soon</h4>
									<p class="card-text">Coming Soon</p>
								</div>
							</div>
						</div>
					</div>
					<div class="col-sm-6">
						<div class="card text-white bg-primary mb-3">
							<div class="card-header">Ranking</div>
							<div class="card-body">
								<table id="ranking-table" data-row-style="rankingRowStyle" class="text-white" data-toggle="table" data-url="/api/ranking/">
									<thead>
										<tr>
											<th data-field="club.name">Club</th>
											<th data-field="played">Played</th>
											<th data-field="points">Points</th>
										</tr>
									</thead>
								</table>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- /#page-content-wrapper -->

  </div>
  <!-- /#wrapper -->

  <div th:replace="common/scripts :: scripts"></div>
	<script>
		var nextMatchDate;
		function matchRowStyle(row, index) {
			var classes = "cursor-pointer";
			if(localStorage.getItem("user")){
				var clubName = JSON.parse(localStorage.getItem("user")).club.name;
				if(row.home.name == clubName || row.away.name == clubName){
					nextMatchDate = new Date(row.date);
					classes += " bg-info"
				}
			}
			return {
				classes : classes
			}
		}
		
		function rankingRowStyle(row, index) {
			var classes = "cursor-pointer";
			if(localStorage.getItem("user")){
				var clubName = JSON.parse(localStorage.getItem("user")).club.name;
				if(row.club.name == clubName || row.club.name == clubName){
					classes += " bg-info"
				}
			}
			return {
				classes : classes
			}
		}
		
		$("#next-round-table").on("click-cell.bs.table", function (field, value, row, $element) {
	   	    if (value !="operate"){
	   	    	window.location.href = '/match/' + $element.id;
	   	    }
	   	});
		
		$("#previous-round-table").on("click-cell.bs.table", function (field, value, row, $element) {
	   	    if (value !="operate"){
	   	    	window.location.href = '/match/' + $element.id;
	   	    }
	   	});
		
		function refresh() {
			console.log(nextMatchDate);
			var now = new Date(); 
			var dif = (nextMatchDate - now); 
            var dif = Math.round((dif/1000)/60); 
            console.log("Minutes left = " + dif);
		    //setTimeout(refresh, 5000);
		}

		setTimeout(refresh, 5000);
		function moneyFormat (labelValue) {

		    // Nine Zeroes for Billions
		    return Math.abs(Number(labelValue)) >= 1.0e+9

		    ? Math.abs(Number(labelValue)) / 1.0e+9 + "B"
		    // Six Zeroes for Millions 
		    : Math.abs(Number(labelValue)) >= 1.0e+6

		    ? Math.abs(Number(labelValue)) / 1.0e+6 + "M"
		    // Three Zeroes for Thousands
		    : Math.abs(Number(labelValue)) >= 1.0e+3

		    ? Math.abs(Number(labelValue)) / 1.0e+3 + "K"

		    : Math.abs(Number(labelValue));

		}
		var user = JSON.parse(localStorage.getItem("user"));
		$("#balance").html(moneyFormat(user.club.finance.balance));
		$("#username").html(user.username);
		$("#level").append(user.level);
		$("#level").css("width", user.levelProgress + "%");
	</script>
</body>

</html>